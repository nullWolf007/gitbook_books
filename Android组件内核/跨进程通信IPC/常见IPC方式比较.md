

[TOC]

## 常见IPC方式比较

### 一、应用多进程

#### 1.1 多进程优点

* 扩大内存

  * 每个进程分配的内存是固定的，想要更大的内存可以是一个App有多个进程

  ```shell
  >adb shell
  vbox86p:/ # su
  vbox86p:/ # getprop dalvik.vm.heapsize
  ```

* 隔离风险

  * 比如下载工作交给另一个进程，那么下载崩溃不会影响主进程

#### 1.2 特点

* 一个应用不同进程的组件会拥有独立的虚拟机、Application以及内存空间

#### 1.3 应用多进程存在的问题

* 静态成员和单例模式完全失效

* 线程同步机制完全失效

* SharedPreferences的可靠性下降

* Application会多次创建

### 二、IPC的定义

* IPC即Inter-Process Communication的缩写，即进程间通信或者跨进程通信

* process属性

  ```xml
  android:process=""
  ```

### 三、Android中IPC常用的方式及优缺点

* RPC：远程过程调用（在不同的进程之间，一个进程调用另一个进程中的对象）

|      名称       |                             优点                             |                             缺点                             |                           使用场景                           |
| :-------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|     Bundle      |                           简单易用                           |                 只能传输Bundle支持的数据类型                 |                    四大组件间的进程间通信                    |
|    文件共享     |                           简单易用                           |    不适合高并发场景，并且**无法**做到进程间的**即时通信**    |        无并发访问情形，交换简单的数据实时性不高的场景        |
|      AIDL       |          功能强大，支持一对多并发通信，支持实时通信          |                使用稍复杂，需要处理好线程同步                |                    一对多通信且有RPC需求                     |
|    Messenger    |          功能一般，支持一对多串行通信，支持实时通信          | 不能很好处理高并发情形，不支持RPC，数据通过Message进行传输，因此只能传输Bundle支持的数据格式 | 低并发的一对多即时通信，无RPC需求，或者无需要返回结果的RPC需求 |
| ContentProvider | 在数据源访问方面功能强大，支持一对多并发数据共享，可通过Call方法扩展其他操作 |       可以理解为受约束的AIDL。主要提供数据源的CRUD操作       |                   一对多的进程间的数据共享                   |
|     Socket      |   功能强大，可以通过网络传输字节流，支持一对多并发实时通信   |            实现细节稍微有点繁琐，不支持直接的RPC             |                         网络数据交换                         |
